#!/bin/bash

if [ $# != 3 -o "_$1" == "_-h" -o "_$1" == "_-?" ]; then
  cat << HELP
Usage: tw-url-rep <screen_name> <status_id> <image>

post to <screen_name> <status_id> with an <image> (specified by url or local-path)
HELP
  exit 0
fi

IMG=$3
case $IMG in
  http*)
    LOC="/tmp/${IMG##*/}"
    wget --quiet -O $LOC $IMG
    ;;
  *)
    LOC=$IMG
    ;;
esac

if [ ! -f $LOC ]; then
  cat << ERR
File not found (missed: $3)
ERR
  exit 0
fi

twurl -X POST "/1.1/statuses/update_with_media.json" --file $LOC --file-field "media[]" -d "in_reply_to_status_id=$2" -d "status=@$1"
